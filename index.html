<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belmond Fansite</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #683D46;
            --primary-dark: #4A2B32;
            --accent: #A8758A;
            --light-accent: #C9A8B5;
            --bg-dark: #140B0F;
            --bg-mid: #25161C;
            --text-main: #F0E8FF;
            --text-sub: #D4C8D0;
            --shadow: rgba(104, 61, 70, 0.45);
        }
        body {
            font-family: "Kaisei Opti", serif;
            background: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* --- Header (ÂÖ±ÈÄö) --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: rgba(104, 61, 70, 0.88);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(201, 168, 181, 0.15);
            transition: all 0.3s ease;
        }
        header.scrolled { padding: 0.6rem 0; background: rgba(74, 43, 50, 0.94); }
        .inner { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 80px; }
        .site-title { font-size: 1.9rem; font-weight: 700; color: var(--light-accent); letter-spacing: 1px; }
        .Menu ul { list-style: none; display: flex; gap: 2.5rem; }
        .Menu li a { text-decoration: none; color: var(--text-sub); font-size: 1.1rem; position: relative; transition: 0.3s; }
        .Menu li a:hover, .Menu li a.active { color: #fff; }
        .Menu li a::after { content: ""; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; background: var(--accent); transition: 0.3s; transform: translateX(-50%); }
        .Menu li a.active::after { width: 80%; }
        

        main {
            padding-top: 100px;
        }

        .CharacterBox {
            position: relative;
            width: 100%;
            height: 400px;
            background-color: var(--bg-mid);
            overflow: hidden;
        }
        .CharacterBox::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(0deg, var(--primary) 0%, transparent 60%);
            z-index: 2;
        }
        .CharacterBackground {
            position: absolute;
            right: 0;
            top: 33%;
            transform: translateY(-50%) scale(1.5);
            height: 100%;
            width: auto;
            z-index: 1;
            object-fit: contain;
        }
        .TitleText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "Kaisei Opti";
            color: white;
            z-index: 3;
            font-size: 5.5rem;
            font-weight: 700;
            text-shadow: 0 4px 30px var(--shadow);
            letter-spacing: 2px;
        }

        .follower-wrap {
            position: absolute;
            bottom: 15%;
            left: 6%;
            z-index: 4;
            color: white;
            text-shadow: 0 2px 15px rgba(0,0,0,0.6);
        }
        .follower-label {
            font-family: "DotGothic16", sans-serif;
            font-size: 1.35rem;
            color: var(--light-accent);
            margin-bottom: 0.3rem;
            letter-spacing: 1px;
        }
        .follower-count {
            font-family: "DotGothic16", sans-serif;
            font-size: 4.2rem;
            font-weight: normal;
            line-height: 1;
            color: #ffffff;
            display: inline-block;
        }
        .follower-unit {
            font-family: "DotGothic16", sans-serif;
            font-size: 2.1rem;
            color: var(--accent);
            vertical-align: middle;
            margin-left: 0.25rem;
        }
        .last-updated {
            font-family: "Kaisei Opti", serif;
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }

        /* ÂãïÁîª„Ç´„É´„Éº„Çª„É´ */
        .VideoSection {
            max-width: 100%;
            margin: 4rem 0 6rem;
            padding: 0 1rem;
        }
        .VideoSection h2 {
            font-size: 2.8rem;
            text-align: center;
            margin-bottom: 2.5rem;
            color: var(--light-accent);
            text-shadow: 0 2px 12px var(--shadow);
        }
        .ticker-wrapper {
            overflow: hidden;
            width: 100%;
            position: relative;
        }
        .ticker {
            display: flex;
            flex-wrap: nowrap;
            will-change: transform;
        }
        .ticker:hover {
            animation-play-state: paused;
        }
        .video-card {
            flex: 0 0 360px;
            margin-right: 2rem;
            background: var(--bg-mid);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 24px var(--shadow);
            transition: all 0.35s ease;
            cursor: pointer;
        }
        .ticker:hover .video-card {
            transform: scale(1.05);
        }
        .video-card:hover {
            transform: scale(1.09);
            box-shadow: 0 16px 40px rgba(104, 61, 70, 0.6);
        }
        .thumbnail-wrapper {
            position: relative;
            padding-top: 56.25%;
            overflow: hidden;
            background: #000;
        }
        .thumbnail {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .video-card:hover .thumbnail {
            transform: scale(1.15);
        }
        .video-info {
            padding: 1.3rem 1.5rem;
        }
        .video-title {
            font-size: 1.25rem;
            line-height: 1.5;
            margin-bottom: 0.9rem;
            color: var(--text-main);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .video-meta {
            font-size: 0.95rem;
            color: var(--text-sub);
            display: flex;
            flex-wrap: wrap;
            gap: 0.9rem;
        }
        .video-meta span {
            background: rgba(168, 117, 138, 0.18);
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* „É¢„Éº„ÉÄ„É´ */
        #videoModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            position: relative;
            width: 100%;
            max-width: 960px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(168,117,138,0.4);
        }
        .close-btn {
            position: absolute;
            top: 12px;
            right: 16px;
            font-size: 2.2rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            text-shadow: 0 0 8px black;
        }
        .video-player {
            position: relative;
            padding-top: 56.25%;
        }
        .video-player iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }

        @media (max-width: 1024px) {
            .video-card { flex: 0 0 320px; margin-right: 1.6rem; }
        }
        @media (max-width: 768px) {
            .TitleText { font-size: 4rem; }
            .follower-count { font-size: 3.4rem; }
            .video-card { flex: 0 0 280px; margin-right: 1.4rem; }
            .VideoSection h2 { font-size: 2.2rem; }
        }
        @media (max-width: 768px) {
            .SectionTitle { font-size: 2.2rem; }
            .inner { padding: 0 1rem; }
            .Menu ul { gap: 1rem; }
        }
    </style>
</head>
<body>
<header>
    <div class="inner">
        <div class="site-title">Belmond(ÈùûÂÖ¨Âºè:„Éï„Ç°„É≥„Çµ„Ç§„Éà)</div>
        <nav class="Menu">
            <ul>
                <li><a href="./index.html" class="active">Index</a></li>
                <li><a href="./videos.html">Video</a></li>
                <li><a href="./about.html">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="CharacterBox">
        <p class="TitleText">„Åä„Éê„É≥„Åß„Åô</p>

        <div class="follower-wrap">
            <div class="follower-label">„ÉÅ„É£„É≥„Éç„É´ÁôªÈå≤ËÄÖÊï∞</div>
            <div>
                <span class="follower-count" id="followerCount">0</span>
                <span class="follower-unit">‰∫∫</span>
            </div>
            <div class="last-updated" id="lastUpdated">„Éá„Éº„ÇøÂèñÂæó‰∏≠...</div>
        </div>

        <!--<img class="CharacterBackground" src="./assets/assets01.png" alt="Belmond">-->
    </div>

    <section class="VideoSection">
        <h2>„Éô„É´„É¢„É≥„Éâ„Éª„Éê„É≥„Éá„É©„Çπ„ÅÆÊúÄÊñ∞ÈÖç‰ø°„Éª„Ç¢„Éº„Ç´„Ç§„Éñ</h2>
        
        <div class="ticker-wrapper">
            <div class="ticker" id="videoTicker">
                <!-- JavaScript„ÅßÂÖ®ÂãïÁîª„Çí2„Çª„ÉÉ„ÉàÊåøÂÖ• -->
            </div>
        </div>
    </section>

    <div style="height: 80vh; padding: 3rem; font-size: 1.3rem; color: var(--text-sub); text-align: center;">
        <p>„Åì„ÅÆ„Çµ„Ç§„Éà„ÅØ„ÄÅ„Å´„Åò„Åï„Çì„ÅòÊâÄÂ±û„ÅÆVTuber„Äå„Éô„É´„É¢„É≥„Éâ„Éª„Éê„É≥„Éá„É©„Çπ„Äç„Åï„Çì„ÅÆÈùûÂÖ¨Âºè„Éï„Ç°„É≥„Çµ„Ç§„Éà„Åß„Åô„ÄÇ</p>
        <br>
        <p>„ÇÜ„Å£„Åè„Çä„Çπ„ÇØ„É≠„Éº„É´„Åó„Å™„Åå„ÇâÊúÄÊñ∞ÂãïÁîª„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Å≠ü•É</p>
    </div>
</main>

<!-- ÂãïÁîªÂÜçÁîü„É¢„Éº„ÉÄ„É´ -->
<div id="videoModal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">&times;</span>
        <div class="video-player" id="playerContainer"></div>
    </div>
</div>

<script>
window.addEventListener('scroll', () => {
    const header = document.querySelector('header');
    header.classList.toggle('scrolled', window.scrollY > 50);
});

function countUp(element, target, duration = 2800) {
    let start = 0;
    const stepTime = 35;
    const steps = duration / stepTime;
    const increment = target / steps;

    const timer = setInterval(() => {
        start += increment;
        if (start >= target) {
            start = target;
            clearInterval(timer);
        }
        element.textContent = Math.floor(start).toLocaleString();
    }, stepTime);
}

async function loadFollowerCount() {
    try {
        const response = await fetch('https://belmond-fansite.vercel.app/api/userApi');
        if (!response.ok) throw new Error('API„Ç®„É©„Éº');
        const data = await response.json();

        const countElement = document.getElementById('followerCount');
        const updatedElement = document.getElementById('lastUpdated');

        countUp(countElement, Number(data.followers));

        const date = new Date(data.last_updated);
        const formatted = date.toLocaleString('ja-JP', {
            year: 'numeric', month: 'short', day: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
        updatedElement.textContent = `ÊúÄÁµÇÊõ¥Êñ∞Ôºö${formatted}`;
    } catch (err) {
        console.error(err);
        document.getElementById('followerCount').textContent = '‚Äî';
        document.getElementById('lastUpdated').textContent = 'ÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
    }
}

function startTickerLoop() {
    const ticker = document.getElementById('videoTicker');
    let pos = 0;
    let speed = 0.5; // ‚Üê ÊµÅ„Çå„ÇãÈÄü„ÅïÔºàÂ∞è„Åï„ÅÑ„Åª„Å©„ÇÜ„Å£„Åè„ÇäÔºâ

    function loop() {
        pos -= speed;

        const halfWidth = ticker.scrollWidth / 2;
        if (Math.abs(pos) >= halfWidth) {
            pos = 0;
        }

        ticker.style.transform = `translateX(${pos}px)`;
        requestAnimationFrame(loop);
    }

    loop();
}

async function loadVideos() {
    try {
        const response = await fetch('https://belmond-fansite.vercel.app/api/videosApi');
        if (!response.ok) throw new Error('ÂãïÁîªAPI„Ç®„É©„Éº');
        const data = await response.json();

        const ticker = document.getElementById('videoTicker');
        ticker.innerHTML = '';

        const createCard = (video) => {
            const date = new Date(video.published_at || video.actual_end_time || video.scheduled_start_time);
            const dateStr = date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            const card = document.createElement('div');
            card.className = 'video-card';
            card.dataset.videoId = video._id;

            card.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img class="thumbnail" 
                         src="${video.thumbnail_url || `https://i.ytimg.com/vi/${video._id}/maxresdefault.jpg`}" 
                         alt="${video.title.replace(/"/g, '&quot;')}" 
                         loading="lazy">
                </div>
                <div class="video-info">
                    <h3 class="video-title">${video.title}</h3>
                    <div class="video-meta">
                        <span>üëÄ ${video.view_count.toLocaleString()} Âõû</span>
                        <span>‚ù§Ô∏è ${video.like_count.toLocaleString()}</span>
                        <span>üí¨ ${video.comment_count}</span>
                        <span>${dateStr}</span>
                        <span>${video.content_category.toUpperCase()}</span>
                    </div>
                </div>
            `;

            card.addEventListener('click', () => openVideoModal(video._id, video.title));
            return card;
        };

        // 1„Çª„ÉÉ„ÉàÁõÆ
        data.videos.forEach(video => ticker.appendChild(createCard(video)));
        // 2„Çª„ÉÉ„ÉàÁõÆÔºà„É´„Éº„ÉóÁî®Ôºâ
        data.videos.forEach(video => ticker.appendChild(createCard(video)));

        // ÂãïÁîª„ÅåÊ•µÁ´Ø„Å´Â∞ë„Å™„ÅÑÂ†¥Âêà„ÅÆ‰øùÈô∫
        if (data.videos.length < 4) {
            data.videos.forEach(video => ticker.appendChild(createCard(video)));
        }
        startTickerLoop();
    } catch (err) {
        console.error(err);
        document.getElementById('videoTicker').innerHTML = 
            '<p style="text-align:center; padding:6rem 1rem; font-size:1.5rem; color:var(--text-sub);">ÂãïÁîª„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü‚Ä¶</p>';
    }
}

function openVideoModal(videoId, title) {
    const modal = document.getElementById('videoModal');
    const container = document.getElementById('playerContainer');

    container.innerHTML = `
        <iframe 
            src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
            title="${title.replace(/"/g, '&quot;')}" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
        </iframe>
    `;

    modal.style.display = 'flex';
}

function closeVideoModal() {
    const modal = document.getElementById('videoModal');
    const container = document.getElementById('playerContainer');
    container.innerHTML = '';
    modal.style.display = 'none';
}

document.getElementById('closeModal').addEventListener('click', closeVideoModal);
document.getElementById('videoModal').addEventListener('click', e => {
    if (e.target === document.getElementById('videoModal')) closeVideoModal();
});

window.addEventListener('load', () => {
    loadFollowerCount();
    loadVideos();
});
</script>
</body>
</html>