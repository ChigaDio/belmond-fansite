<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belmond Fansite</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #683D46;
            --primary-dark: #4A2B32;
            --accent: #A8758A;
            --light-accent: #C9A8B5;
            --bg-dark: #140B0F;
            --bg-mid: #25161C;
            --text-main: #F0E8FF;
            --text-sub: #D4C8D0;
            --shadow: rgba(104, 61, 70, 0.45);
        }
        body {
            font-family: "Kaisei Opti", serif;
            background: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* --- Header (å…±é€š) --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: rgba(104, 61, 70, 0.88);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(201, 168, 181, 0.15);
            transition: all 0.3s ease;
        }
        header.scrolled { padding: 0.6rem 0; background: rgba(74, 43, 50, 0.94); }
        .inner { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 80px; }
        .site-title { font-size: 1.9rem; font-weight: 700; color: var(--light-accent); letter-spacing: 1px; }
        .Menu ul { list-style: none; display: flex; gap: 2.5rem; }
        .Menu li a { text-decoration: none; color: var(--text-sub); font-size: 1.1rem; position: relative; transition: 0.3s; }
        .Menu li a:hover, .Menu li a.active { color: #fff; }
        .Menu li a::after { content: ""; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; background: var(--accent); transition: 0.3s; transform: translateX(-50%); }
        .Menu li a.active::after { width: 80%; }
        

        main {
            padding-top: 100px;
        }

        .CharacterBox {
            position: relative;
            width: 100%;
            height: 400px;
            background-color: var(--bg-mid);
            overflow: hidden;
        }
        .CharacterBox::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(0deg, var(--primary) 0%, transparent 60%);
            z-index: 2;
        }
        .CharacterBackground {
            position: absolute;
            right: 0;
            top: 33%;
            transform: translateY(-50%) scale(1.5);
            height: 100%;
            width: auto;
            z-index: 1;
            object-fit: contain;
            transition: opacity 1s ease-in-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ç”¨ */
        }
        .CharacterBackground.fade-out {
            opacity: 0;
        }
        
        .TitleText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "Kaisei Opti";
            color: white;
            z-index: 3;
            font-size: 5.5rem;
            font-weight: 700;
            text-shadow: 0 4px 30px var(--shadow);
            letter-spacing: 2px;
        }

        .follower-wrap {
            position: absolute;
            bottom: 15%;
            left: 6%;
            z-index: 4;
            color: white;
            text-shadow: 0 2px 15px rgba(0,0,0,0.6);
        }
        .follower-label {
            font-family: "DotGothic16", sans-serif;
            font-size: 1.35rem;
            color: var(--light-accent);
            margin-bottom: 0.3rem;
            letter-spacing: 1px;
        }
        .follower-count {
            font-family: "DotGothic16", sans-serif;
            font-size: 4.2rem;
            font-weight: normal;
            line-height: 1;
            color: #ffffff;
            display: inline-block;
        }
        .follower-unit {
            font-family: "DotGothic16", sans-serif;
            font-size: 2.1rem;
            color: var(--accent);
            vertical-align: middle;
            margin-left: 0.25rem;
        }
        .last-updated {
            font-family: "Kaisei Opti", serif;
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }

        /* ä½œè€…æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .author-info {
            position: absolute;
            top: 10%; /* èª¿æ•´å¯èƒ½ */
            right: 10%; /* èƒŒæ™¯ç”»åƒã®ä¸Šã«é…ç½®ã€èª¿æ•´å¯èƒ½ */
            z-index: 3;
            background: rgba(37, 22, 28, 0.75); /* åŠé€æ˜èƒŒæ™¯ã§ãŠã—ã‚ƒã‚Œã« */
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
            color: var(--text-main);
            font-size: 1.1rem;
            text-align: right;
            opacity: 1;
            transition: opacity 1s ease-in-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ç”¨ */
            max-width: 300px;
        }
        .author-info.fade-out {
            opacity: 0;
        }
        .author-name {
            font-weight: 700;
            color: var(--light-accent);
            margin-bottom: 0.5rem;
        }
        .author-link {
            color: var(--accent);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s;
        }
        .author-link:hover {
            color: #fff;
        }
        .author-link::before {
            content: "@";
            font-family: "DotGothic16", sans-serif;
            color: var(--text-sub);
        }

        /* å‹•ç”»ã‚«ãƒ«ãƒ¼ã‚»ãƒ« */
        .VideoSection {
            max-width: 100%;
            margin: 4rem 0 6rem;
            padding: 0 1rem;
        }
        .VideoSection h2 {
            font-size: 2.8rem;
            text-align: center;
            margin-bottom: 2.5rem;
            color: var(--light-accent);
            text-shadow: 0 2px 12px var(--shadow);
        }
        .ticker-wrapper {
            overflow: hidden;
            width: 100%;
            position: relative;
        }
        .ticker {
            display: flex;
            flex-wrap: nowrap;
            will-change: transform;
        }
        .ticker:hover {
            animation-play-state: paused;
        }
        .video-card {
            flex: 0 0 360px;
            margin-right: 2rem;
            background: var(--bg-mid);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 24px var(--shadow);
            transition: all 0.35s ease;
            cursor: pointer;
        }
        .ticker:hover .video-card {
            transform: scale(1.05);
        }
        .video-card:hover {
            transform: scale(1.09);
            box-shadow: 0 16px 40px rgba(104, 61, 70, 0.6);
        }
        .thumbnail-wrapper {
            position: relative;
            padding-top: 56.25%;
            overflow: hidden;
            background: #000;
        }
        .thumbnail {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .video-card:hover .thumbnail {
            transform: scale(1.15);
        }
        .video-info {
            padding: 1.3rem 1.5rem;
        }
        .video-title {
            font-size: 1.25rem;
            line-height: 1.5;
            margin-bottom: 0.9rem;
            color: var(--text-main);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .video-meta {
            font-size: 0.95rem;
            color: var(--text-sub);
            display: flex;
            flex-wrap: wrap;
            gap: 0.9rem;
        }
        .video-meta span {
            background: rgba(168, 117, 138, 0.18);
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #videoModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            position: relative;
            width: 100%;
            max-width: 960px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 60px rgba(168,117,138,0.4);
        }
        .close-btn {
            position: absolute;
            top: 12px;
            right: 16px;
            font-size: 2.2rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            text-shadow: 0 0 8px black;
        }
        .video-player {
            position: relative;
            padding-top: 56.25%;
        }
        .video-player iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
        }

        @media (max-width: 1024px) {
            .video-card { flex: 0 0 320px; margin-right: 1.6rem; }
        }
        @media (max-width: 768px) {
            .TitleText { font-size: 4rem; }
            .follower-count { font-size: 3.4rem; }
            .video-card { flex: 0 0 280px; margin-right: 1.4rem; }
            .VideoSection h2 { font-size: 2.2rem; }
        }
        @media (max-width: 768px) {
            .SectionTitle { font-size: 2.2rem; }
            .inner { padding: 0 1rem; }
            .Menu ul { gap: 1rem; }
            .author-info { top: 5%; right: 5%; font-size: 1rem; padding: 0.8rem 1.2rem; }
        }
    </style>
</head>
<body>
<header>
    <div class="inner">
        <div class="site-title">Belmond(éå…¬å¼:ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ)</div>
        <nav class="Menu">
            <ul>
                <li><a href="./index.html" class="active">Index</a></li>
                <li><a href="./videos.html">Video</a></li>
                <li><a href="./about.html">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="CharacterBox">
        <p class="TitleText">ãŠãƒãƒ³ã§ã™</p>

        <div class="follower-wrap">
            <div class="follower-label">ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²è€…æ•°</div>
            <div>
                <span class="follower-count" id="followerCount">0</span>
                <span class="follower-unit">äºº</span>
            </div>
            <div class="last-updated" id="lastUpdated">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</div>
        </div>

        <img class="CharacterBackground" src="./assets/assets01.png" alt="Belmond">

        <!-- ä½œè€…æƒ…å ±è¡¨ç¤º -->
        <div class="author-info" id="authorInfo">
            <div class="author-name" id="authorName"></div>
            <a href="#" class="author-link" id="authorLink" target="_blank" rel="noopener noreferrer"></a>
        </div>
    </div>

    <section class="VideoSection">
        <h2>ãƒ™ãƒ«ãƒ¢ãƒ³ãƒ‰ãƒ»ãƒãƒ³ãƒ‡ãƒ©ã‚¹ã®æœ€æ–°é…ä¿¡ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h2>
        
        <div class="ticker-wrapper">
            <div class="ticker" id="videoTicker">
                <!-- JavaScriptã§å…¨å‹•ç”»ã‚’2ã‚»ãƒƒãƒˆæŒ¿å…¥ -->
            </div>
        </div>
    </section>

    <div style="height: 80vh; padding: 3rem; font-size: 1.3rem; color: var(--text-sub); text-align: center;">
        <p>ã“ã®ã‚µã‚¤ãƒˆã¯ã€ã«ã˜ã•ã‚“ã˜æ‰€å±ã®VTuberã€Œãƒ™ãƒ«ãƒ¢ãƒ³ãƒ‰ãƒ»ãƒãƒ³ãƒ‡ãƒ©ã‚¹ã€ã•ã‚“ã®éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã§ã™ã€‚</p>
        <br>
        <p>ã‚†ã£ãã‚Šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãªãŒã‚‰æœ€æ–°å‹•ç”»ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã­ğŸ¥ƒ</p>
    </div>
</main>

<!-- å‹•ç”»å†ç”Ÿãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="videoModal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">&times;</span>
        <div class="video-player" id="playerContainer"></div>
    </div>
</div>

<script>
window.addEventListener('scroll', () => {
    const header = document.querySelector('header');
    header.classList.toggle('scrolled', window.scrollY > 50);
});

let siteTitle = document.querySelector('.site-title');
let titleText = document.querySelector('.TitleText');
let siteStartFontSize = parseFloat(getComputedStyle(siteTitle).fontSize);
let titleStartFontSize = parseFloat(getComputedStyle(titleText).fontSize);
window.addEventListener('resize', function() {
    const windowWidth = window.innerWidth;

    if(windowWidth < window.screen.width * 0.3)
    {
        siteTitle.style.fontSize = `${siteStartFontSize * 0.5}px`;
        titleText.style.fontSize = `${titleStartFontSize * 0.5}px`;
    }
    else
    {
        siteTitle.style.fontSize = `${siteStartFontSize}px`;
        titleText.style.fontSize = `${titleStartFontSize}px`;
    }
});

function countUp(element, target, duration = 2800) {
    let start = 0;
    const stepTime = 35;
    const steps = duration / stepTime;
    const increment = target / steps;

    const timer = setInterval(() => {
        start += increment;
        if (start >= target) {
            start = target;
            clearInterval(timer);
        }
        element.textContent = Math.floor(start).toLocaleString();
    }, stepTime);
}

async function loadFollowerCount() {
    try {
        const response = await fetch('https://belmond-fansite.vercel.app/api/userApi');
        if (!response.ok) throw new Error('APIã‚¨ãƒ©ãƒ¼');
        const data = await response.json();

        const countElement = document.getElementById('followerCount');
        const updatedElement = document.getElementById('lastUpdated');

        countUp(countElement, Number(data.followers));

        const date = new Date(data.last_updated);
        const formatted = date.toLocaleString('ja-JP', {
            year: 'numeric', month: 'short', day: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
        updatedElement.textContent = `æœ€çµ‚æ›´æ–°ï¼š${formatted}`;
    } catch (err) {
        console.error(err);
        document.getElementById('followerCount').textContent = 'â€”';
        document.getElementById('lastUpdated').textContent = 'å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
    }
}

function startTickerLoop() {
    const ticker = document.getElementById('videoTicker');
    let pos = 0;
    let speed = 0.5; // â† æµã‚Œã‚‹é€Ÿã•ï¼ˆå°ã•ã„ã»ã©ã‚†ã£ãã‚Šï¼‰

    function loop() {
        pos -= speed;

        const halfWidth = ticker.scrollWidth / 2;
        if (Math.abs(pos) >= halfWidth) {
            pos = 0;
        }

        ticker.style.transform = `translateX(${pos}px)`;
        requestAnimationFrame(loop);
    }

    loop();
}

async function loadVideos() {
    try {
        const response = await fetch('https://belmond-fansite.vercel.app/api/videosApi');
        if (!response.ok) throw new Error('å‹•ç”»APIã‚¨ãƒ©ãƒ¼');
        const data = await response.json();

        const ticker = document.getElementById('videoTicker');
        ticker.innerHTML = '';

        const createCard = (video) => {
            const date = new Date(video.published_at || video.actual_end_time || video.scheduled_start_time);
            const dateStr = date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            const card = document.createElement('div');
            card.className = 'video-card';
            card.dataset.videoId = video._id;

            card.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img class="thumbnail" 
                         src="${video.thumbnail_url || `https://i.ytimg.com/vi/${video._id}/maxresdefault.jpg`}" 
                         alt="${video.title.replace(/"/g, '&quot;')}" 
                         loading="lazy">
                </div>
                <div class="video-info">
                    <h3 class="video-title">${video.title}</h3>
                    <div class="video-meta">
                        <span>ğŸ‘€ ${video.view_count.toLocaleString()} å›</span>
                        <span>â¤ï¸ ${video.like_count.toLocaleString()}</span>
                        <span>ğŸ’¬ ${video.comment_count}</span>
                        <span>${dateStr}</span>
                        <span>${video.content_category.toUpperCase()}</span>
                    </div>
                </div>
            `;

            card.addEventListener('click', () => openVideoModal(video._id, video.title));
            return card;
        };

        // 1ã‚»ãƒƒãƒˆç›®
        data.videos.forEach(video => ticker.appendChild(createCard(video)));
        // 2ã‚»ãƒƒãƒˆç›®ï¼ˆãƒ«ãƒ¼ãƒ—ç”¨ï¼‰
        data.videos.forEach(video => ticker.appendChild(createCard(video)));

        // å‹•ç”»ãŒæ¥µç«¯ã«å°‘ãªã„å ´åˆã®ä¿é™º
        if (data.videos.length < 4) {
            data.videos.forEach(video => ticker.appendChild(createCard(video)));
        }
        startTickerLoop();
    } catch (err) {
        console.error(err);
        document.getElementById('videoTicker').innerHTML = 
            '<p style="text-align:center; padding:6rem 1rem; font-size:1.5rem; color:var(--text-sub);">å‹•ç”»ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸâ€¦</p>';
    }
}

function openVideoModal(videoId, title) {
    const modal = document.getElementById('videoModal');
    const container = document.getElementById('playerContainer');

    container.innerHTML = `
        <iframe 
            src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
            title="${title.replace(/"/g, '&quot;')}" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
        </iframe>
    `;

    modal.style.display = 'flex';
}

function closeVideoModal() {
    const modal = document.getElementById('videoModal');
    const container = document.getElementById('playerContainer');
    container.innerHTML = '';
    modal.style.display = 'none';
}

document.getElementById('closeModal').addEventListener('click', closeVideoModal);
document.getElementById('videoModal').addEventListener('click', e => {
    if (e.target === document.getElementById('videoModal')) closeVideoModal();
});

// æ–°æ©Ÿèƒ½: èƒŒæ™¯ç”»åƒã¨ä½œè€…æƒ…å ±ã®ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã¨å®šæœŸåˆ‡ã‚Šæ›¿ãˆ
let backgroundData = []; // APIã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿é…åˆ—
let currentIndex = -1;
const switchInterval = 10000; // åˆ‡ã‚Šæ›¿ãˆé–“éš” (10ç§’)
let switchTimer;

async function loadBackgroundData() {
    try {
        // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä»®å®š (å®Ÿéš›ã®API URLã«ç½®ãæ›ãˆ)
        const response = await fetch('https://belmond-fansite.vercel.app/api/backgroundsApi'); // ä»®ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        if (!response.ok) throw new Error('èƒŒæ™¯APIã‚¨ãƒ©ãƒ¼');
        backgroundData = await response.json(); // é…åˆ—å½¢å¼ã§ {authorName, authorId, authorLink, imageUrl, localAssetPath, positionX, positionY, scale} ã‚’æƒ³å®š

        if (backgroundData.length > 0) {
            switchBackground(); // åˆå›è¡¨ç¤º
            switchTimer = setInterval(switchBackground, switchInterval); // å®šæœŸåˆ‡ã‚Šæ›¿ãˆ
        }
    } catch (err) {
        console.error(err);
        // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã®ã¾ã¾
    }
}

function getRandomIndex(excludeCurrent = true) {
    let index = Math.floor(Math.random() * backgroundData.length);
    if (excludeCurrent && index === currentIndex) {
        index = (index + 1) % backgroundData.length;
    }
    return index;
}

function switchBackground() {
    const bgElement = document.querySelector('.CharacterBackground');
    const authorInfo = document.getElementById('authorInfo');
    const authorName = document.getElementById('authorName');
    const authorLink = document.getElementById('authorLink');

    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
    bgElement.classList.add('fade-out');
    authorInfo.classList.add('fade-out');

    setTimeout(() => {
        // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
        currentIndex = getRandomIndex();
        const data = backgroundData[currentIndex];

        // ç”»åƒæ›´æ–° (localAssetPathã‚’ä½¿ã†ãŒã€imageUrlã‚‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½)
        bgElement.src = data.localAssetPath || data.imageUrl;
        bgElement.style.right = `${data.positionX}%`; // ä¾‹: rightã‚’positionXã§èª¿æ•´ (å¿…è¦ã«å¿œã˜ã¦)
        bgElement.style.top = `${data.positionY}%`; // ä¾‹: topã‚’positionYã§èª¿æ•´
        bgElement.style.transform = `translateY(-50%) scale(${data.scale})`;

        // ä½œè€…æƒ…å ±æ›´æ–°
        authorName.textContent = data.authorName;
        authorLink.textContent = data.authorId; // @ã®å‰ã«è¡¨ç¤º
        authorLink.href = data.authorLink;

        // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
        bgElement.classList.remove('fade-out');
        authorInfo.classList.remove('fade-out');
    }, 1000); // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ™‚é–“ã¨åŒæœŸ
}

window.addEventListener('load', () => {
    const windowWidth = window.innerWidth;
    if(windowWidth < window.screen.width * 0.3)
    {
        siteTitle.style.fontSize = `${siteStartFontSize * 0.5}px`;
        titleText.style.fontSize = `${titleStartFontSize * 0.5}px`;
    }
    else
    {
        siteTitle.style.fontSize = `${siteStartFontSize}px`;
        titleText.style.fontSize = `${titleStartFontSize}px`;
    }
    loadFollowerCount();
    loadVideos();
    loadBackgroundData(); // æ–°ã—ã„æ©Ÿèƒ½ã®ãƒ­ãƒ¼ãƒ‰
});
</script>
</body>
</html>