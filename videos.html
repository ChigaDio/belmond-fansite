<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belmond Fansite</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #683D46;
            --primary-dark: #4A2B32;
            --accent: #A8758A;
            --light-accent: #C9A8B5;
            --bg-dark: #140B0F;
            --bg-mid: #25161C;
            --text-main: #F0E8FF;
            --text-sub: #D4C8D0;
            --shadow: rgba(104, 61, 70, 0.45);
        }
        body {
            font-family: "Kaisei Opti", serif;
            background: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* ==================== „Éò„ÉÉ„ÉÄ„Éº ==================== */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            background: rgba(104, 61, 70, 0.88);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(201, 168, 181, 0.15);
            transition: all 0.3s ease;
        }
        header.scrolled { padding: 0.6rem 0; background: rgba(74, 43, 50, 0.94); }
        .inner { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; height: 80px; }
        .site-title { font-size: 1.9rem; font-weight: 700; color: var(--light-accent); letter-spacing: 1px; }
        .Menu ul { list-style: none; display: flex; gap: 2.5rem; }
        .Menu li a { text-decoration: none; color: var(--text-sub); font-size: 1.1rem; position: relative; transition: 0.3s; }
        .Menu li a:hover, .Menu li a.active { color: #fff; }
        .Menu li a::after { content: ""; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; background: var(--accent); transition: 0.3s; transform: translateX(-50%); }
        .Menu li a.active::after { width: 80%; }

        main {
            padding-top: 100px;
        }

        /* ==================== CharacterBox ==================== */
        .CharacterBox {            
            position: relative;
            width: 100%;
            height: 400px;
            background-color: var(--bg-mid);
            overflow: hidden;
        }
        .CharacterBox::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(0deg, var(--primary) 0%, transparent 60%);
            z-index: 2;
        }
        .CharacterBackground {
            position: absolute;
            right: 0;
            top: 170%;
            transform: translateY(-50%) scale(3.5);
            height: 100%;
            width: auto;
            z-index: 1;
            object-fit: contain;
        }
        .TitleText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "Kaisei Opti";
            color: white;
            z-index: 3;
            font-size: 5.5rem;
            font-weight: 700;
            text-shadow: 0 4px 30px var(--shadow);
            letter-spacing: 2px;
        }

        .follower-wrap {
            position: absolute;
            bottom: 15%;
            left: 6%;
            z-index: 4;
            color: white;
            text-shadow: 0 2px 15px rgba(0,0,0,0.6);
        }
        .follower-label {
            font-family: "DotGothic16", sans-serif;
            font-size: 1.35rem;
            color: var(--light-accent);
            margin-bottom: 0.3rem;
            letter-spacing: 1px;
        }
        .follower-count {
            font-family: "DotGothic16", sans-serif;
            font-size: 4.2rem;
            font-weight: normal;
            line-height: 1;
            color: #ffffff;
            display: inline-block;
        }
        .follower-unit {
            font-family: "DotGothic16", sans-serif;
            font-size: 2.1rem;
            color: var(--accent);
            vertical-align: middle;
            margin-left: 0.25rem;
        }
        .last-updated {
            font-family: "Kaisei Opti", serif;
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-top: 0.5rem;
        }

        /* ==================== ÂãïÁîª„Çª„ÇØ„Ç∑„Éß„É≥ ==================== */
        .VideoSection {
            max-width: 1280px;
            margin: 4rem auto;
            padding: 0 2rem;
        }
        .VideoSection h2 {
            font-size: 2.9rem;
            text-align: center;
            margin-bottom: 2.5rem;
            color: var(--light-accent);
            text-shadow: 0 2px 12px var(--shadow);
        }

        /* „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ */
        .controls {
            background: var(--bg-mid);
            padding: 1.8rem 2rem;
            border-radius: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 2.5rem;
        }
        .controls input[type="text"],
        .controls input[type="date"],
        .controls select {
            padding: 0.85rem 1.1rem;
            background: #3a252e;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.02rem;
        }
        .controls input[type="text"] { flex: 1; min-width: 280px; }
        .controls button {
            padding: 0.85rem 1.8rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        .controls button:hover { background: #d89ab3; transform: translateY(-2px); }

        /* „Åä„Åó„ÇÉ„Çå„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„É™„Çπ„Éà */
        .playlist-wrapper {
            background: linear-gradient(145deg, #3a252e, #2f1e27);
            border: 1px solid rgba(168, 117, 138, 0.35);
            border-radius: 14px;
            padding: 1rem 1.2rem;
            min-width: 280px;
            max-width: 400px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 6px 20px rgba(104, 61, 70, 0.25);
            transition: all 0.3s ease;
        }
        .playlist-wrapper:hover {
            border-color: var(--light-accent);
            box-shadow: 0 10px 30px rgba(168, 117, 138, 0.3);
        }

        .playlist-item {
            display: flex;
            align-items: center;
            margin: 0.6rem 0;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .playlist-item:hover {
            transform: translateX(6px);
        }

        .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 22px;
            height: 22px;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        .custom-checkbox input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 22px;
            width: 22px;
            background: #2a1c24;
            border: 2px solid var(--light-accent);
            border-radius: 7px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        .custom-checkbox:hover .checkmark {
            border-color: var(--accent);
            box-shadow: 0 0 12px rgba(168, 117, 138, 0.4);
        }
        .custom-checkbox input:checked ~ .checkmark {
            background: linear-gradient(135deg, var(--accent), #d89ab3);
            border-color: transparent;
            box-shadow: 0 0 15px rgba(168, 117, 138, 0.7);
        }
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 7px;
            top: 3px;
            width: 7px;
            height: 13px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }
        .custom-checkbox input:checked ~ .checkmark:after {
            display: block;
        }

        .playlist-label {
            color: var(--text-sub);
            font-size: 0.97rem;
            transition: color 0.25s;
        }
        .playlist-item:hover .playlist-label {
            color: white;
        }

        .playlist-wrapper::-webkit-scrollbar {
            width: 7px;
        }
        .playlist-wrapper::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        .playlist-wrapper::-webkit-scrollbar-track {
            background: #2a1c24;
            border-radius: 4px;
        }

        .playlist-error {
            color: #ffaaaa;
            font-size: 0.96rem;
            padding: 1rem;
            text-align: center;
            background: rgba(255, 170, 170, 0.08);
            border-radius: 8px;
        }

        /* „Çø„Ç∞ÂÖ•Âäõ„Çπ„Çø„Ç§„É´ÔºàÂ§âÊõ¥„Å™„ÅóÔºâ */
        .tag-container {
            min-height: 38px;
            padding: 0.4rem 0.8rem;
            background: #3a252e;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }
        .tag-container:focus-within {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
            border-radius: 10px;
        }
        .search-tag {
            background: var(--light-accent);
            color: var(--bg-dark);
            padding: 0.35rem 0.9rem;
            border-radius: 999px;
            font-size: 0.94rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            white-space: nowrap;
        }
        .search-tag span {
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* „Ç∞„É™„ÉÉ„Éâ„Éª„Ç´„Éº„Éâ„Éª„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„Éª„É¢„Éº„ÉÄ„É´ÔºàÂ§âÊõ¥„Å™„ÅóÔºâ */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(310px, 1fr));
            gap: 2.6rem;
        }
        .video-card {
            background: var(--bg-mid);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow);
            transition: all 0.35s ease;
            cursor: pointer;
        }
        .video-card:hover {
            transform: translateY(-12px) scale(1.03);
            box-shadow: 0 20px 45px rgba(104, 61, 70, 0.6);
        }
        .thumbnail-wrapper {
            position: relative;
            padding-top: 56.25%;
            overflow: hidden;
            background: #000;
        }
        .thumbnail {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .video-card:hover .thumbnail {
            transform: scale(1.12);
        }
        .video-info {
            padding: 1.4rem 1.5rem;
        }
        .video-title {
            font-size: 1.38rem;
            line-height: 1.45;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: var(--text-main);
        }
        .video-meta {
            font-size: 0.96rem;
            color: var(--text-sub);
            display: flex;
            flex-wrap: wrap;
            gap: 0.9rem;
        }
        .video-meta span {
            background: rgba(168, 117, 138, 0.18);
            padding: 0.35rem 0.85rem;
            border-radius: 999px;
            white-space: nowrap;
        }
        .playlist-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.6rem;
        }
        .playlist-tag {
            background: rgba(201,168,181,0.25);
            color: var(--light-accent);
            padding: 0.25rem 0.7rem;
            border-radius: 999px;
            font-size: 0.82rem;
            border: 1px solid rgba(201,168,181,0.15);
        }

        .pagination {
            margin: 4rem auto 2rem;
            text-align: center;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .pagination button {
            min-width: 42px;
            height: 42px;
            padding: 0 14px;
            background: var(--bg-mid);
            color: var(--text-main);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.05rem;
            transition: all 0.2s;
        }
        .pagination button:hover { background: var(--accent); color: white; }
        .pagination button.active {
            background: var(--accent);
            color: white;
            font-weight: 700;
        }
        .pagination button.ellipsis {
            background: transparent;
            cursor: pointer;
            color: var(--accent);
        }

        #videoModal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.94);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-content {
            position: relative;
            width: 100%;
            max-width: 980px;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
        }
        .close-btn {
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 2.6rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            text-shadow: 0 0 10px black;
        }
        .video-player {
            position: relative;
            padding-top: 56.25%;
        }
        .video-player iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }

        @media (max-width: 1200px) {
            .video-grid { grid-template-columns: repeat(3, minmax(300px, 1fr)); }
        }
        @media (max-width: 860px) {
            .video-grid { grid-template-columns: repeat(2, minmax(290px, 1fr)); }
        }
        @media (max-width: 560px) {
            .video-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; align-items: stretch; }
        }
        @media (max-width: 768px) {
            .inner { padding: 0 1rem; }
            .Menu ul { gap: 1rem; }
        }
    </style>
</head>
<body>
<header>
    <div class="inner">
        <div class="site-title">Belmond</div>
        <nav class="Menu">
            <ul>
                <li><a href="./index.html" >Index</a></li>
                <li><a href="./videos.html" class="active">Video</a></li>
                <li><a href="./about.html">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="CharacterBox">
        <p class="TitleText">„Åä„Éê„É≥„Åß„Åô</p>

        <div class="follower-wrap">
            <div class="follower-label">„ÉÅ„É£„É≥„Éç„É´ÁôªÈå≤ËÄÖÊï∞</div>
            <div>
                <span class="follower-count" id="followerCount">0</span>
                <span class="follower-unit">‰∫∫</span>
            </div>
            <div class="last-updated" id="lastUpdated">„Éá„Éº„ÇøÂèñÂæó‰∏≠...</div>
        </div>

        <img class="CharacterBackground" src="./assets/Background.png" alt="Belmond">
    </div>

    <section class="VideoSection">
        <h2>ÊúÄÊñ∞„ÅÆÈÖç‰ø°„Éª„Ç¢„Éº„Ç´„Ç§„Éñ</h2>

        <div class="controls">
            <div style="position: relative; flex: 1; min-width: 320px;">
                <div id="searchTags" class="tag-container">
                    <input type="text" id="searchInput" placeholder="„Çø„Ç§„Éà„É´Ê§úÁ¥¢Ôºà„Çπ„Éö„Éº„Çπ„ÅßË§áÊï∞ANDÔºâ" 
                           style="flex:1; min-width:180px; background:transparent; border:none; color:white; font-size:1.02rem; outline:none;">
                </div>
            </div>

            <div class="playlist-wrapper">
                <div id="playlistCheckboxes"></div>
            </div>

            <input type="date" id="startDate">
            <span style="color:#aaa; font-size:1.1rem;">„Äú</span>
            <input type="date" id="endDate">

            <select id="typeFilter">
                <option value="">„Åô„Åπ„Å¶„ÅÆ„Çø„Ç§„Éó</option>
                <option value="live">„É©„Ç§„Éñ</option>
                <option value="shorts">„Ç∑„Éß„Éº„Éà</option>
                <option value="normal_video">ÈÄöÂ∏∏ÂãïÁîª</option>
            </select>

            <select id="sortSelect">
                <option value="published_at,-1">Êñ∞ÁùÄÈ†Ü</option>
                <option value="view_count,-1">ÂÜçÁîüÂõûÊï∞ Â§ö„ÅÑÈ†Ü</option>
                <option value="like_count,-1">„ÅÑ„ÅÑ„Å≠ Â§ö„ÅÑÈ†Ü</option>
                <option value="comment_count,-1">„Ç≥„É°„É≥„Éà Â§ö„ÅÑÈ†Ü</option>
            </select>

            <button onclick="applyFilters()">Ê§úÁ¥¢„ÉªÊõ¥Êñ∞</button>
            <button onclick="resetFilters()" style="background:#555;">„É™„Çª„ÉÉ„Éà</button>
        </div>

        <div class="video-grid" id="videoGrid"></div>

        <div class="pagination" id="pagination"></div>
    </section>

    <div style="height: 80vh; padding: 4rem 2rem; font-size: 1.35rem; color: var(--text-sub); text-align: center;">
        <p>„Åì„ÅÆ„Çµ„Ç§„Éà„ÅØ„ÄÅ„Å´„Åò„Åï„Çì„ÅòÊâÄÂ±û„ÅÆVTuber„Äå„Éô„É´„É¢„É≥„Éâ„Éª„Éê„É≥„Éá„É©„Çπ„Äç„Åï„Çì„ÅÆ„Éï„Ç°„É≥„Çµ„Ç§„Éà„Åß„Åô„ÄÇ</p>
    </div>
</main>

<div id="videoModal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">√ó</span>
        <div class="video-player" id="playerContainer"></div>
    </div>
</div>

<script>
let currentPage = 1;
let currentSearchTags = [];
let currentPlaylists = [];
let currentStartDate = '';
let currentEndDate = '';
let currentType = '';
let currentSort = 'published_at,-1';

// „Éò„ÉÉ„ÉÄ„Éº„Çπ„ÇØ„É≠„Éº„É´
window.addEventListener('scroll', () => {
    document.querySelector('header').classList.toggle('scrolled', window.scrollY > 50);
});

// „Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó
function countUp(element, target, duration = 2800) {
    let start = 0;
    const stepTime = 35;
    const steps = duration / stepTime;
    const increment = target / steps;
    const timer = setInterval(() => {
        start += increment;
        if (start >= target) { start = target; clearInterval(timer); }
        element.textContent = Math.floor(start).toLocaleString();
    }, stepTime);
}

// ÁôªÈå≤ËÄÖÊï∞
async function loadFollowerCount() {
    try {
        const response = await fetch('https://belmond-fansite.vercel.app/api/userApi');
        if (!response.ok) throw new Error();
        const data = await response.json();

        countUp(document.getElementById('followerCount'), Number(data.followers));

        const date = new Date(data.last_updated);
        document.getElementById('lastUpdated').textContent = 
            `ÊúÄÁµÇÊõ¥Êñ∞Ôºö${date.toLocaleString('ja-JP', {year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit'})}`;
    } catch (e) {
        document.getElementById('followerCount').textContent = '‚Äî';
        document.getElementById('lastUpdated').textContent = 'ÂèñÂæóÂ§±Êïó';
    }
}

// „Éó„É¨„Ç§„É™„Çπ„Éà„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπË™≠„ÅøËæº„Åø
async function loadPlaylists() {
    const container = document.getElementById('playlistCheckboxes');
    container.innerHTML = '<div style="color:#aaa; text-align:center; padding:1rem;">Ë™≠„ÅøËæº„Åø‰∏≠...</div>';

    try {
        const res = await fetch('https://belmond-fansite.vercel.app/api/playListApi');
        if (!res.ok) throw new Error(`Status ${res.status}`);

        let data = await res.json();
        const lists = Array.isArray(data) ? data : [data].filter(Boolean);

        container.innerHTML = '';

        if (lists.length === 0) {
            container.innerHTML = '<div class="playlist-error">„Éó„É¨„Ç§„É™„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            return;
        }

        lists.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));

        lists.forEach(pl => {
            const item = document.createElement('div');
            item.className = 'playlist-item';

            const date = new Date(pl.published_at);
            const dateStr = date.toLocaleDateString('ja-JP', {year:'numeric', month:'short', day:'numeric'});

            item.innerHTML = `
                <label class="custom-checkbox">
                    <input type="checkbox" value="${pl.title}">
                    <span class="checkmark"></span>
                </label>
                <span class="playlist-label">${pl.title} (${pl.video_count}Êú¨) - ${dateStr}</span>
            `;
            container.appendChild(item);
        });
    } catch (err) {
        console.error('„Éó„É¨„Ç§„É™„Çπ„ÉàÂèñÂæóÂ§±Êïó:', err);
        container.innerHTML = '<div class="playlist-error">„Éó„É¨„Ç§„É™„Çπ„ÉàÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºàAPI„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ</div>';
    }
}

// „Çø„Ç∞ÂÖ•ÂäõÔºàÂÖ®Ëßí„Çπ„Éö„Éº„ÇπÂØæÂøúÔºâ
const searchInput = document.getElementById('searchInput');
const tagContainer = document.getElementById('searchTags');

searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ' || e.key === '„ÄÄ' || e.key === ',') {
        e.preventDefault();
        const val = searchInput.value.trim();
        if (val && !currentSearchTags.includes(val)) {
            currentSearchTags.push(val);
            renderTags();
        }
        searchInput.value = '';
    } else if (e.key === 'Backspace' && searchInput.value === '' && currentSearchTags.length > 0) {
        currentSearchTags.pop();
        renderTags();
    }
});

function renderTags() {
    tagContainer.querySelectorAll('.search-tag').forEach(t => t.remove());
    currentSearchTags.forEach((text, idx) => {
        const tag = document.createElement('div');
        tag.className = 'search-tag';
        tag.innerHTML = `${text} <span onclick="removeTag(${idx})">√ó</span>`;
        tagContainer.insertBefore(tag, searchInput);
    });
}

window.removeTag = idx => {
    currentSearchTags.splice(idx, 1);
    renderTags();
};

// ÈÅ∏Êäû‰∏≠„ÅÆ„Éó„É¨„Ç§„É™„Çπ„Éà
function getSelectedPlaylists() {
    const checked = document.querySelectorAll('#playlistCheckboxes input:checked');
    return Array.from(checked).map(input => encodeURIComponent(input.value));  // Âøµ„ÅÆ„Åü„ÇÅ„Ç®„É≥„Ç≥„Éº„Éâ
}

// „Éï„Ç£„É´„ÇøÈÅ©Áî®
function applyFilters() {
    const val = searchInput.value.trim();
    if (val && !currentSearchTags.includes(val)) {
            currentSearchTags.push(val);
            renderTags();
    }
    currentSearchTags = currentSearchTags.filter(t => t.trim());
    currentPlaylists = getSelectedPlaylists();
    currentStartDate = document.getElementById('startDate').value;
    currentEndDate = document.getElementById('endDate').value;
    currentType = document.getElementById('typeFilter').value;
    currentSort = document.getElementById('sortSelect').value;
    loadVideos(1);
}

// „É™„Çª„ÉÉ„Éà
function resetFilters() {
    currentSearchTags = [];
    renderTags();
    searchInput.value = '';

    document.querySelectorAll('#playlistCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = false);

    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
    document.getElementById('typeFilter').value = '';
    document.getElementById('sortSelect').value = 'published_at,-1';

    currentPlaylists = [];
    currentStartDate = '';
    currentEndDate = '';
    currentType = '';
    currentSort = 'published_at,-1';
    loadVideos(1);
}

// ÂãïÁîªË™≠„ÅøËæº„Åø
async function loadVideos(page = 1) {
    currentPage = page;
    const url = new URL('https://belmond-fansite.vercel.app/api/videosDetailsApi');
    
    url.searchParams.set('page', page);
    if (currentSearchTags.length) url.searchParams.set('search', currentSearchTags.join(','));
    if (currentPlaylists.length) url.searchParams.set('playlists', currentPlaylists.join(','));
    if (currentStartDate) url.searchParams.set('startDate', currentStartDate);
    if (currentEndDate) url.searchParams.set('endDate', currentEndDate);
    if (currentType) url.searchParams.set('type', currentType);
    
    const [sortField, sortOrder] = currentSort.split(',');
    url.searchParams.set('sortBy', sortField);
    url.searchParams.set('sortOrder', sortOrder);

    try {
        const res = await fetch(url);
        if (!res.ok) throw new Error();
        const data = await res.json();

        const grid = document.getElementById('videoGrid');
        grid.innerHTML = '';

        data.videos.forEach(video => {
            const date = new Date(video.published_at || video.actual_end_time || video.scheduled_start_time);

            let playlistHtml = '';
            if (video.playlist_titles && video.playlist_titles.length > 0) {
                playlistHtml = '<div class="playlist-tags">';
                video.playlist_titles.forEach(title => {
                    playlistHtml += `<span class="playlist-tag">${title}</span>`;
                });
                playlistHtml += '</div>';
            }

            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img class="thumbnail" 
                         src="${video.thumbnail_url || `https://i.ytimg.com/vi/${video._id}/maxresdefault.jpg`}" 
                         alt="${video.title}" loading="lazy">
                </div>
                <div class="video-info">
                    <div class="video-title">${video.title}</div>
                    <div class="video-meta">
                        <span>üëÄ ${video.view_count.toLocaleString()}Âõû</span>
                        <span>‚ù§Ô∏è ${video.like_count.toLocaleString()}</span>
                        <span>üí¨ ${video.comment_count}</span>
                        <span>${date.toLocaleDateString('ja-JP')}</span>
                    </div>
                    ${playlistHtml}
                </div>
            `;
            card.addEventListener('click', () => openVideoModal(video._id, video.title));
            grid.appendChild(card);
        });

        renderSmartPagination(data.currentPage, data.totalPages);
    } catch (err) {
        document.getElementById('videoGrid').innerHTML = `<p style="grid-column:1/-1;text-align:center;padding:4rem;font-size:1.4rem;">ÂãïÁîª„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>`;
    }
}

// „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥
function renderSmartPagination(current, total) {
    const container = document.getElementById('pagination');
    container.innerHTML = '';

    if (total <= 1) return;

    const pages = [];
    if (total <= 8) {
        for (let i = 1; i <= total; i++) pages.push(i);
    } else {
        pages.push(1);
        if (current > 4) pages.push('...');
        const start = Math.max(2, current - 2);
        const end = Math.min(total - 1, current + 2);
        for (let i = start; i <= end; i++) pages.push(i);
        if (current < total - 3) pages.push('...');
        if (pages[pages.length - 1] !== total) pages.push(total);
    }

    pages.forEach(p => {
        const btn = document.createElement('button');
        btn.textContent = p;
        if (p === current) btn.classList.add('active');
        if (p === '...') {
            btn.classList.add('ellipsis');
            btn.onclick = () => {
                const input = prompt(`„Éö„Éº„Ç∏Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (1„Äú${total})`, current);
                if (input !== null) {
                    const num = parseInt(input);
                    if (!isNaN(num) && num >= 1 && num <= total) loadVideos(num);
                }
            };
        } else {
            btn.onclick = () => loadVideos(p);
        }
        container.appendChild(btn);
    });
}

// „É¢„Éº„ÉÄ„É´
function openVideoModal(videoId, title) {
    document.getElementById('playerContainer').innerHTML = `
        <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                title="${title}" frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen></iframe>
    `;
    document.getElementById('videoModal').style.display = 'flex';
}
document.getElementById('closeModal').addEventListener('click', () => {
    document.getElementById('videoModal').style.display = 'none';
    document.getElementById('playerContainer').innerHTML = '';
});

// ÂàùÊúüÂåñ
window.addEventListener('load', () => {
    loadFollowerCount();
    loadPlaylists();
    loadVideos(1);
});
</script>
</body>
</html>