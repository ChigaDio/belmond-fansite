<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belmond Fansite</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Kaisei+Opti:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #683D46; --accent: #A8758A; --light-accent: #C9A8B5;
            --bg-dark: #140B0F; --bg-mid: #25161C;
            --text-main: #F0E8FF; --text-sub: #D4C8D0; --shadow: rgba(104,61,70,0.45);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: "Kaisei Opti", serif;
            background: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
        }
        header {
            position: fixed; top:0; left:0; width:100%; z-index:1000;
            background: rgba(104,61,70,0.88); backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(201,168,181,0.15);
            transition: all .3s;
        }
        header.scrolled { padding:0.6rem 0; background:rgba(74,43,50,0.94); box-shadow:0 4px 20px var(--shadow); }
        .inner { max-width:1200px; margin:0 auto; padding:0 2rem; display:flex; justify-content:space-between; align-items:center; height:80px; }
        .site-title { font-size:1.9rem; font-weight:700; color:var(--light-accent); text-shadow:0 2px 10px var(--shadow); }

        main { padding-top:100px; }

        /* CharacterBoxï¼ˆãã®ã¾ã¾ï¼‰ */
        .CharacterBox { position:relative; width:100%; height:400px; background:var(--bg-mid); overflow:hidden; }
        .CharacterBox::before { content:""; position:absolute; inset:0; background:linear-gradient(0deg,var(--primary) 0%,transparent 60%); z-index:2; }
        .CharacterBackground { position:absolute; right:0; top:170%; transform:translateY(-50%) scale(3.5); height:100%; z-index:1; }
        .TitleText { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:5.5rem; font-weight:700; color:white; z-index:3; text-shadow:0 4px 30px var(--shadow); }

        .follower-wrap { position:absolute; bottom:15%; left:6%; z-index:4; color:white; text-shadow:0 2px 15px rgba(0,0,0,0.6); }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .controls {
            max-width:1200px; margin:2rem auto; padding:0 2rem;
            display:flex; flex-wrap:wrap; gap:1rem; align-items:center; background:var(--bg-mid); padding:1.5rem; border-radius:12px;
        }
        .controls input, .controls select, .controls button {
            padding:0.7rem 1rem; border:none; border-radius:8px; background:#3a252e; color:white; font-size:1rem;
        }
        .controls button { background:var(--accent); cursor:pointer; font-weight:700; }
        .controls button:hover { background:#c98ab0; }

        /* ã‚°ãƒªãƒƒãƒ‰ï¼ˆ4åˆ—å›ºå®šï¼‰ */
        .VideoSection { max-width:1200px; margin:0 auto; padding:0 2rem; }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
        }
        .video-card {
            background:var(--bg-mid); border-radius:12px; overflow:hidden; box-shadow:0 6px 20px var(--shadow);
            transition:all .3s; cursor:pointer;
        }
        .video-card:hover { transform:translateY(-10px); box-shadow:0 15px 35px var(--shadow); }
        .thumbnail-wrapper { position:relative; padding-top:56.25%; overflow:hidden; background:#000; }
        .thumbnail { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; transition:transform .4s; }
        .video-card:hover .thumbnail { transform:scale(1.1); }
        .video-info { padding:1.2rem; }
        .video-title { font-size:1.25rem; line-height:1.45; margin-bottom:0.8rem; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
        .video-meta { font-size:0.92rem; color:var(--text-sub); display:flex; flex-wrap:wrap; gap:0.6rem; }
        .video-meta span { background:rgba(168,117,138,0.15); padding:0.2rem 0.7rem; border-radius:999px; white-space:nowrap; }

        /* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */
        .pagination {
            max-width:1200px; margin:3rem auto; padding:0 2rem; text-align:center;
        }
        .pagination button {
            margin:0 4px; padding:0.6rem 1.1rem; background:var(--bg-mid); border:none; border-radius:8px; color:white; cursor:pointer;
        }
        .pagination button.active { background:var(--accent); font-weight:700; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        #videoModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.93); z-index:2000; align-items:center; justify-content:center; padding:1rem; }
        .modal-content { position:relative; width:100%; max-width:960px; background:#000; border-radius:12px; overflow:hidden; }
        .close-btn { position:absolute; top:12px; right:18px; font-size:2.5rem; color:white; cursor:pointer; z-index:10; }

        @media (max-width: 1100px) { .video-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { .video-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
<header>
    <div class="inner">
        <div class="site-title">Belmond</div>
        <nav class="Menu">
            <ul>
                <li><a href="./index.html" class="active">Index</a></li>
                <li><a href="./videos.html">Video</a></li>
                <li><a href="./about.html">About</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="CharacterBox">
        <p class="TitleText">ãŠãƒãƒ³ã§ã™</p>
        <div class="follower-wrap">
            <div class="follower-label">ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²è€…æ•°</div>
            <div><span class="follower-count" id="followerCount">0</span><span class="follower-unit">äºº</span></div>
            <div class="last-updated" id="lastUpdated">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</div>
        </div>
        <img class="CharacterBackground" src="./assets/Background.png" alt="Belmond">
    </div>

    <section class="VideoSection">
        <h2 style="text-align:center; font-size:2.8rem; margin:2.5rem 0; color:var(--light-accent);">æœ€æ–°ã®é…ä¿¡ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h2>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="controls">
            <input type="text" id="searchInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã§æ¤œç´¢..." style="flex:1; min-width:260px;">
            
            <input type="date" id="startDate" style="width:140px;">
            <span style="color:#aaa;">ã€œ</span>
            <input type="date" id="endDate" style="width:140px;">

            <select id="typeFilter">
                <option value="">ã™ã¹ã¦</option>
                <option value="live">Live</option>
                <option value="shorts">Shorts</option>
                <option value="video">é€šå¸¸å‹•ç”»</option>
            </select>

            <select id="sortSelect">
                <option value="publishedAt,-1">æ–°ç€é †</option>
                <option value="view_count,-1">å†ç”Ÿå›æ•°å¤šã„é †</option>
                <option value="like_count,-1">ã„ã„ã­å¤šã„é †</option>
                <option value="comment_count,-1">ã‚³ãƒ¡ãƒ³ãƒˆå¤šã„é †</option>
            </select>

            <button onclick="applyFilters()">æ¤œç´¢ãƒ»æ›´æ–°</button>
        </div>

        <div class="video-grid" id="videoGrid"></div>

        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
        <div class="pagination" id="pagination"></div>
    </section>

    <div style="height:80vh; padding:4rem 2rem; text-align:center; font-size:1.3rem; color:var(--text-sub);">
        <p>ã«ã˜ã•ã‚“ã˜æ‰€å± VTuberã€Œãƒ™ãƒ«ãƒ¢ãƒ³ãƒ‰ãƒ»ãƒãƒ³ãƒ‡ãƒ©ã‚¹ã€ã•ã‚“ã®ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã§ã™ğŸ¥ƒ</p>
    </div>
</main>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="videoModal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">Ã—</span>
        <div class="video-player" id="playerContainer"></div>
    </div>
</div>

<script>
// å…±é€šå¤‰æ•°
let currentPage = 1;
let currentSearch = '';
let currentStartDate = '';
let currentEndDate = '';
let currentType = '';
let currentSort = 'publishedAt,-1';

// ãƒ˜ãƒƒãƒ€ãƒ¼
window.addEventListener('scroll', () => {
    document.querySelector('header').classList.toggle('scrolled', window.scrollY > 50);
});

// ç™»éŒ²è€…æ•°ï¼ˆãã®ã¾ã¾ï¼‰
async function loadFollowerCount() {
    try {
        const res = await fetch('https://belmond-fansite.vercel.app/api/userApi');
        const data = await res.json();
        const el = document.getElementById('followerCount');
        let n = 0;
        const target = Number(data.followers);
        const timer = setInterval(() => {
            n += Math.ceil(target/60);
            if (n >= target) { n = target; clearInterval(timer); }
            el.textContent = n.toLocaleString();
        }, 30);
        const date = new Date(data.last_updated);
        document.getElementById('lastUpdated').textContent = `æœ€çµ‚æ›´æ–°ï¼š${date.toLocaleString('ja-JP')}`;
    } catch(e) { console.error(e); }
}

// å‹•ç”»èª­ã¿è¾¼ã¿ï¼ˆå…¨ãƒ•ã‚£ãƒ«ã‚¿å¯¾å¿œï¼‰
async function loadVideos(page = 1) {
    currentPage = page;
    const url = new URL('https://belmond-fansite.vercel.app/api/videosApi');
    url.searchParams.set('page', page);
    if (currentSearch) url.searchParams.set('search', currentSearch);
    if (currentStartDate) url.searchParams.set('startDate', currentStartDate);
    if (currentEndDate) url.searchParams.set('endDate', currentEndDate);
    if (currentType) url.searchParams.set('type', currentType);
    if (currentSort) {
        const [field, order] = currentSort.split(',');
        url.searchParams.set('sortBy', field);
        url.searchParams.set('sortOrder', order);
    }

    try {
        const res = await fetch(url);
        const data = await res.json();

        // ã‚°ãƒªãƒƒãƒ‰æç”»
        const grid = document.getElementById('videoGrid');
        grid.innerHTML = '';
        data.videos.forEach(v => {
            const card = document.createElement('div');
            card.className = 'video-card';
            const date = new Date(v.published_at || v.actual_end_time);
            card.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img class="thumbnail" src="${v.thumbnail_url || `https://i.ytimg.com/vi/${v._id}/maxresdefault.jpg`}" loading="lazy">
                </div>
                <div class="video-info">
                    <div class="video-title">${v.title}</div>
                    <div class="video-meta">
                        <span>ğŸ‘€ ${v.view_count.toLocaleString()}</span>
                        <span>â¤ï¸ ${v.like_count.toLocaleString()}</span>
                        <span>ğŸ’¬ ${v.comment_count}</span>
                        <span>${date.toLocaleDateString('ja-JP')}</span>
                    </div>
                </div>
            `;
            card.onclick = () => openVideoModal(v._id, v.title);
            grid.appendChild(card);
        });

        // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
        renderPagination(data.currentPage, data.totalPages);
    } catch(e) {
        document.getElementById('videoGrid').innerHTML = '<p style="grid-column:1/-1;text-align:center;padding:3rem;">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</p>';
    }
}

function renderPagination(current, total) {
    const container = document.getElementById('pagination');
    container.innerHTML = '';
    for (let i = 1; i <= total; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        if (i === current) btn.classList.add('active');
        btn.onclick = () => loadVideos(i);
        container.appendChild(btn);
    }
}

// ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨
function applyFilters() {
    currentSearch = document.getElementById('searchInput').value.trim();
    currentStartDate = document.getElementById('startDate').value;
    currentEndDate = document.getElementById('endDate').value;
    currentType = document.getElementById('typeFilter').value;
    currentSort = document.getElementById('sortSelect').value;
    loadVideos(1);
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«
function openVideoModal(id, title) {
    document.getElementById('playerContainer').innerHTML = `
        <iframe src="https://www.youtube.com/embed/${id}?autoplay=1" 
                frameborder="0" allowfullscreen style="width:100%;height:100%;"></iframe>
    `;
    document.getElementById('videoModal').style.display = 'flex';
}
document.getElementById('closeModal').onclick = () => {
    document.getElementById('videoModal').style.display = 'none';
    document.getElementById('playerContainer').innerHTML = '';
};

// åˆæœŸåŒ–
window.addEventListener('load', () => {
    loadFollowerCount();
    loadVideos(1);
});
</script>
</body>
</html>